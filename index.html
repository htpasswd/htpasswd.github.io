<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
<script src="./datasource.json"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json2html/2.1.0/json2html.min.js"></script>
<!-- Visualizer Core -->
<link href="./lib/visualizer.css" rel="stylesheet">
<script src="./lib/visualizer.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/sha256.js"></script>
</head>

  <body>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<div class="container">
  <button type="button" class="btn btn-primary float-right mt-2 pt-2" data-toggle="modal" id="adminButton">Edit</button>
  <div class="row align-items-center" style="height: calc(100vh - 66px)">
    <div class="col-12">
      <div class="tab-content" id="question-container">
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">Tools Info</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" data-html="true">
        <p><b>SolidWorks</b> is a solid modeling computer-aided design (CAD) and computer-aided engineering (CAE) computer program published by Dassault Systèmes, that runs primarily on Microsoft Windows. While it is possible to run SolidWorks on an Intel-based Mac with Windows installed, the application's developer recommends against this. SolidWorks does not support macOS.</p>
        <p>According to the publisher, over two million engineers and designers at more than 165,000 companies were using SolidWorks as of 2013. Also, according to the company, fiscal year 2011–12 revenue for SolidWorks totaled $483 million.</p>
        <br />
        <p>Official Website: <a href="https://www.solidworks.com/" target="_blank">SolidWorks</a></p>
        <hr>
        <p><b>Autodesk Inventor</b> Inventor allows 2D and 3D data integration in a single environment, creating a virtual representation of the final product that enables users to validate the form, fit, and function of the product before it is ever built. Autodesk Inventor includes parametric, direct edit and freeform modeling tools as well as multi-CAD translation capabilities and in their standard DWG drawings. Inventor uses ShapeManager, Autodesk's proprietary geometric modeling kernel. Autodesk Inventor competes directly with SolidWorks, Solid Edge, and Creo. </p>
        <p>Official Website: <a href="https://www.autodesk.com.sg/products/inventor/overview" target="_blank">Inventor</a></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="adminLoginModal" tabindex="-1" role="dialog" aria-labelledby="adminLoginModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adminLoginModalLabel">Login</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" data-html="true">
        <label for="recipient-name" class="col-form-label">Administrator Password:</label>
        <input type="text" class="form-control" id="password">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="loginButton">Login</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="adminModal" tabindex="-1" role="dialog" aria-labelledby="adminModal" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="adminModalLabel">Edit Datasource</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" data-html="true">
        <label for="message-text" class="col-form-label">Json:</label>
        <textarea class="form-control" id="json-raw-text" rows="10" style="height:100%;"></textarea>
        <hr>
        <div id="jsonVisualize"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-link mr-auto" id="restore">Restore Defaults</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-info" id="jsonVisualizeButton">Visualize</button>
        <button type="button" class="btn btn-primary" id="saveJson">Save</button>
      </div>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="page-footer font-small blue">
    <div class="footer-copyright text-center py-3">УДХТУ, 122 Комп’ютерні науки, 7-КНз:
    <a href="">Радченко Дмитро Валерійович</a>
    </div>
</footer>
<script src="https://d3js.org/d3.v3.js"></script>
<!-- Footer -->
</body>
<script>
$('body').css({
  'background-size': 'cover',
  'min-height': '100vh'
});

let container = $('#question-container');

if (localStorage.getItem('jsonData') === null) {
  window.localStorage.setItem('jsonData', JSON.stringify(jsonDataDefault, null, 4));
}

var v = JSON.parse(window.localStorage.getItem('jsonData'));
var clicksHistory = '';

rebuildQuestion();
function rebuildQuestion() {
    let i = 0;
    if (JSON.stringify(v).startsWith("{")){
        jQuery.each(v, function(question, answers) {
            container.append('<div class="tab-pane fade" id="question-' + i + '" role="tabpanel" aria-labelledby="question-' + i + '-tab">' +
                '<h2 class="text-center text-lobster">' + question + '</h2><br>' +
                '</div>');
            clicksHistory = clicksHistory + question + ' > ';
            jQuery.each(answers, function(answer, nextquestions) {
                $('#question-0').addClass('show active');
                let nextq = JSON.stringify(nextquestions);
                $('#question-' + i).append('<button class="btn btn-quiz btn-answer w-100 text-center text-md-left mb-3 p-5" value="' + encodeURIComponent(nextq) + '">' + answer + '</button>')
            });
            i = i + 1;
        });

        $('.btn-answer').click(function() {
          let that = $(this);
          clicksHistory = clicksHistory + $(this).text() + ' > ';
          $('.btn-answer:visible').off('click');
          let valeur = that.val();
          let tabActive = $('.tab-pane.show.active');
          that.animate({ color: "#ffffff" }, 1500);
          v = JSON.parse(decodeURIComponent(that.val()));
          $('#question-container').html("");
          rebuildQuestion();
        });
    } else {
        container.append('<div class="tab-pane fade" id="question-z" role="tabpanel" aria-labelledby="question-z-tab"><h5 style="text-align: center"><span>' 
            + clicksHistory.substring(0, clicksHistory.length - 3) + '</span></h5></div>');
            $('#question-z').addClass('show active');
            $('#question-z').append('<hr><h2 class="text-center text-lobster">Result: <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#infoModal">' + v + '</button></h2><br></div>');
            $('#question-z').append('<center><a href="">Start Again</a></center>');
    }
}

$(document).on('click', '#adminButton', function(){
  confirmPassword();
  json = window.localStorage.getItem('jsonData');
  $("textarea#json-raw-text").val(json);
  visualizeJson();
});

$(document).on('click', '#jsonVisualizeButton', function(){
  visualizeJson();
});

$(document).on('click', "#saveJson", function(){
  window.localStorage.setItem('jsonData', $("textarea#json-raw-text").val());
  $('#adminModal').modal('toggle');
  location.reload();
});

$(document).on('click', "#restore", function(){
  json = JSON.stringify(jsonDataDefault, null, 4);
  $("textarea#json-raw-text").val(json);
});

$(document).on('click', "#loginButton", function(){
  window.localStorage.setItem('password', $("input#password").val());
  $('#adminLoginModal').modal('toggle');
  confirmPassword();
});

function confirmPassword(){
  $("input#password").val("");
  var originalPassword = "b81d2a09d7d88d63318a33ec701be767ae9ffd942fd4a022fb9f82db4d7764da";
  if (localStorage.getItem('password') === null) {
    $('#adminLoginModal').modal('toggle');
  } else {
    var savedPassword = CryptoJS.SHA256(window.localStorage.getItem('password'));
    if (savedPassword == originalPassword) {
      $('#adminModal').modal('toggle');
    } else {
      $('#adminLoginModal').modal('toggle');
      if (localStorage.getItem('password') !== null) {
        alert("Wrong Password");
      }
    }
  }
}

function visualizeJson() {
  var _visualizer = new visualizer($("#jsonVisualize"));
  _visualizer.visualize(JSON.parse($("textarea#json-raw-text").val()));
}
</script>
</html>
